{% extends "base.html" %}
{% block title %}Services • Local Nexus Controller{% endblock %}

{% block content %}
  <div class="mb-4 p-3 rounded border border-rose-500 bg-rose-900/20">
    <div class="text-sm font-semibold text-rose-200">Debug: Delete Button Status</div>
    <div class="text-xs text-slate-300 mt-1">
      Delete button should be visible below. If you don't see it, do a hard refresh (Ctrl+Shift+R) or clear your browser cache.
    </div>
    <div class="mt-2">
      <button class="btn bg-rose-900 hover:bg-rose-800 border-rose-800 text-xs px-2 py-1" style="display: inline-block !important; visibility: visible !important;">Test Delete Button</button>
    </div>
  </div>

  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold">Service Explorer</h1>
      <p class="text-slate-400 text-sm mt-1">All registered services with controls and drill-downs.</p>
    </div>
    <div class="text-sm text-slate-400">
      Tip: use Import to auto-register new programs.
    </div>
  </div>

  <div class="mt-6 overflow-x-auto rounded-xl border border-slate-800">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-900/60 text-slate-300">
        <tr>
          <th class="text-left px-4 py-3">Name</th>
          <th class="text-left px-4 py-3">Category</th>
          <th class="text-left px-4 py-3">Port</th>
          <th class="text-left px-4 py-3">Status</th>
          <th class="text-left px-4 py-3">URL</th>
          <th class="text-left px-4 py-3">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-800">
        {% for s in services %}
        <tr class="bg-slate-950">
          <td class="px-4 py-3">
            <a class="underline hover:text-white" href="/services/{{ s.id }}">{{ s.name }}</a>
            {% if s.description %}
              <div class="text-xs text-slate-500 mt-1 line-clamp-2">{{ s.description }}</div>
            {% endif %}
          </td>
          <td class="px-4 py-3 text-slate-300">{{ s.category }}</td>
          <td class="px-4 py-3 text-slate-300">{{ s.port if s.port is not none else "—" }}</td>
          <td class="px-4 py-3">
            {% if s.status == "running" %}
              <span class="rounded-full bg-emerald-900/40 border border-emerald-800 px-2 py-1 text-emerald-200">running</span>
            {% elif s.status == "error" %}
              <span class="rounded-full bg-rose-900/40 border border-rose-800 px-2 py-1 text-rose-200">error</span>
            {% else %}
              <span class="rounded-full bg-slate-900/40 border border-slate-800 px-2 py-1 text-slate-300">stopped</span>
            {% endif %}
          </td>
          <td class="px-4 py-3">
            {% if s.local_url %}
              <a class="underline text-blue-400 hover:text-blue-300" href="{{ s.local_url }}" target="_blank">Open →</a>
            {% elif s.port %}
              <a class="underline text-blue-400 hover:text-blue-300" href="http://127.0.0.1:{{ s.port }}" target="_blank">Open →</a>
            {% else %}
              <span class="text-slate-500">—</span>
            {% endif %}
          </td>
          <td class="px-4 py-3">
            <div class="flex flex-wrap gap-2">
              {% if s.local_url %}
                <a href="{{ s.local_url }}" target="_blank" class="btn bg-blue-600 hover:bg-blue-700 border-blue-600 text-xs px-2 py-1">Launch</a>
              {% elif s.port %}
                <a href="http://127.0.0.1:{{ s.port }}" target="_blank" class="btn bg-blue-600 hover:bg-blue-700 border-blue-600 text-xs px-2 py-1">Launch</a>
              {% endif %}
              <button class="btn text-xs px-2 py-1" onclick="lncServiceAction('{{ s.id }}','start', true)">Start</button>
              <button class="btn text-xs px-2 py-1" onclick="lncServiceAction('{{ s.id }}','stop')">Stop</button>
              <button class="btn text-xs px-2 py-1" onclick="lncServiceAction('{{ s.id }}','restart')">Restart</button>
              <button class="btn bg-rose-900 hover:bg-rose-800 border-rose-800 text-xs px-2 py-1" style="display: inline-block !important; visibility: visible !important;" onclick="lncDeleteService('{{ s.id }}')">Delete</button>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
